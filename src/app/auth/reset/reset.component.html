<div class="main-holder">
    <div class="reset-card">
        <div class="message" [ngClass]="messageClass" *ngIf="message">
            {{ message }}
        </div>

        <h2>Reset Password</h2>

        <!-- Show email input if user is not logged in -->
        <div *ngIf="!isuserloggedin && !showOtp && !otpiscoorectwithoutlogin" class="email-input-container">
            <input type="email" [(ngModel)]="auth_emailaddress" placeholder="Enter your email" class="email-input" />
            <button class="resend-btn" (click)="sendingemailtoresetpassword(auth_emailaddress)">Send Code</button>
        </div>

        <!-- Show OTP section -->
        <div *ngIf="showOtp">
            <p>
                Enter the 4-digit code sent to
                <strong>{{ getMaskedEmail(auth_emailaddress) }}</strong>
            </p>

            <div class="otp-container">
                <input type="text" maxlength="1" *ngFor="let n of [0,1,2,3]; let i = index" [(ngModel)]="otp[i]"
                    (input)="onOtpInput(i, $event)" />
            </div>

            <div class="timer-container">
                <svg class="progress-circle" viewBox="0 0 36 36">
                    <path class="circle-bg" d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831" />
                    <path class="circle" [attr.stroke-dasharray]="progress + ', 100'" d="M18 2.0845
             a 15.9155 15.9155 0 0 1 0 31.831
             a 15.9155 15.9155 0 0 1 0 -31.831" />
                    <text x="18" y="20.35" class="timer-text">{{ counter }}</text>
                </svg>
            </div>
        </div>

        <!-- Password reset form when OTP correct but user not logged in -->
        <div *ngIf="otpiscoorectwithoutlogin" class="password-reset-container">
            <input type="password" [(ngModel)]="newPassword" placeholder="Enter new password" class="password-input" />
            <input type="password" [(ngModel)]="confirmNewPassword" placeholder="Re-enter new password"
                class="password-input" />
            <button class="resend-btn" (click)="updatePasswordWithoutLogin()">Update Password</button>
        </div>

        <!-- Resend button for logged-in users -->
        <button *ngIf="!showOtp && isuserloggedin && !otpiscoorectwithoutlogin" class="resend-btn"
            (click)="resendCode()">
            Resend Code
        </button>
    </div>
</div>