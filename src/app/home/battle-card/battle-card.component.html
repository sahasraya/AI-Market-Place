<div class="battle-card-wrapper">

    <select class="select-category" [(ngModel)]="selectedCategory" (change)="onCategoryChange()">
        <option value="" disabled selected>Select a Category</option>
        <option value="AI model">AI model</option>
        <option value="Agent">Agent</option>
        <option value="Voice">Voice</option>
        <option value="Image">Image</option>
        <option value="Video Editing">Video Editing</option>
        <option value="Dev Tools">Dev Tools</option>
        <option value="Utility">Utility</option>
    </select>

    <!-- Search Input (only show after category selected) -->
    <div class="searchinputwrapper" *ngIf="iscategoryselected">
        <h3>Select Tools for Battle (max 3)</h3>
        <input type="text" placeholder="Filter by name..." [(ngModel)]="filterTerm" (input)="onFilterChange()"
            class="search-bar-products">
    </div>

    <!-- Tools list -->
    <div class="filtered-cards-container" *ngIf="displayedTypeTools.length > 0; else noItems">
        <div class="filtered-card" *ngFor="let tool of displayedTypeTools" (click)="toggleSelect(tool)">
            <img [src]="tool.productimage" alt="tool" class="tool-img" />
            <span class="tool-name">{{ tool.productname }}</span>
        </div>
    </div>

    <!-- No items message -->
    <ng-template #noItems>
        <div class="no-items-message">
            No items found for "{{ selectedCategory === '' ? 'Yet' : selectedCategory }}"
        </div>
    </ng-template>
</div>

<!-- Selected tools -->
<div *ngIf="selectedTools.length > 0" class="filtered-cards-wrapper">
    <h3>Selected Tools</h3>
    <div class="filtered-cards-container">
        <div class="filtered-card" *ngFor="let tool of selectedTools">
            <img [src]="tool.productimage" alt="" class="tool-img">
            <span class="tool-name">{{ tool.productname }}</span>
            <div class="select-circle" *ngIf="tool.selected">{{ tool.selected }}</div>
        </div>
    </div>












    <!-- ‚úÖ Selected Models Section -->
    <div *ngIf="selectedTools.length > 0" class="selected-models-wrapper">
        <span class="separater"></span>

        <div class="filtered-cards-container">
            <div class="filtered-card" *ngFor="let tool of displayedSelectedTools" (click)="toggleSelect(tool)">
                <img [src]="tool.productimage" alt="" class="tool-img">
                <span class="tool-name">{{tool.productname}}</span>
                <div class="select-circle">{{tool.selected}}</div>
            </div>
        </div>
    </div>




    <!-- Make Battle Button -->

    <!-- Selected Tools Table -->
    <table *ngIf="selectedTools.length > 0" class="battle-table">
        <thead>
            <tr>
                <th class="property-col">Property</th>
                <th *ngFor="let tool of selectedTools" class="tool-col">
                    <div class="tool-header">
                        <img [src]="tool.productimage" alt="{{tool.productname}}" class="header-tool-img">
                    </div>
                </th>
            </tr>
        </thead>
        <tbody>
            <!-- Product Names -->
            <tr>
                <td class="property">Name</td>
                <td *ngFor="let tool of selectedTools">{{ tool.productname }}</td>
            </tr>

            <tr>
                <td class="property">Rating</td>
                <td *ngFor="let tool of selectedTools">{{ tool.rating }} / 5</td>
            </tr>

            <tr>
                <td class="property">Technology</td>
                <td *ngFor="let tool of selectedTools">{{ tool.producttechnology }}</td>
            </tr>



            <!-- Type -->
            <tr>
                <td class="property">Category</td>
                <td *ngFor="let tool of selectedTools">{{ tool.productcategory }}</td>
            </tr>

            <!-- Tags -->
            <tr>
                <td class="property">Tags</td>
                <td *ngFor="let tool of selectedTools">{{ tool.productusecase.join(', ') }}</td>
            </tr>

            <tr>
                <td class="property">Funding Stage</td>
                <td *ngFor="let tool of selectedTools">{{ tool.productfundingstage }}</td>
            </tr>

            <tr>
                <td class="property">License</td>
                <td *ngFor="let tool of selectedTools">{{ tool.productlicense }}</td>
            </tr>


            <tr>
                <td class="property">Description</td>
                <td *ngFor="let tool of selectedTools">{{ tool.productdescription }}</td>
            </tr>

            <tr>
                <td class="property">Web Site</td>
                <td *ngFor="let tool of selectedTools">
                    <a [href]="tool.productwebsite" target="_blank" class="website-link">
                        Visite
                    </a>
                </td>
            </tr>

            <tr>
                <td class="property">Social</td>
                <td *ngFor="let tool of selectedTools">
                    <div class="social-links">
                        <a *ngIf="tool.productfacebook" [href]="tool.productfacebook" target="_blank">
                            <img src="../../../assets/images/facebook.png" alt="Facebook" class="social-icon">
                        </a>
                        <a *ngIf="tool.productlinkedin" [href]="tool.productlinkedin" target="_blank">
                            <img src="../../../assets/images/linkedin.png" alt="LinkedIn" class="social-icon">
                        </a>
                    </div>
                </td>
            </tr>


            <!-- See Review Button -->
            <tr>
                <td class="property"></td>
                <td *ngFor="let tool of selectedTools">
                    <button class="review-btn" (click)="openReview(tool)">See Reviews</button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Modal -->
    <div *ngIf="popupSelected.length > 0" class="modal-backdrop">
        <div class="modal">
            <span class="close-btn" (click)="closePopup()"> <img src="../../../assets/images/close.png" alt=""></span>
            <div class="modal-content" *ngFor="let product of popupSelected">
                <div class="review-holder" *ngIf="reviews.length > 0; else noReviews">
                    <app-review-card *ngFor="let review of reviews" [review]="review"></app-review-card>
                </div>
            </div>
            <ng-template #noReviews>
                <div class="no-reviews">
                    <div class="no-reviews-icon">üìù</div>
                    <h4>No reviews yet</h4>
                    <p>Be the first to review this product!</p>
                </div>
            </ng-template>


            <div class="load-more-container" *ngIf="hasMoreReviews">
                <button class="loadmorebtn" (click)="loadMoreReviews()" [disabled]="isLoadingMoreReviews">
                    <span *ngIf="!isLoadingMoreReviews">Load More Reviews</span>
                    <span *ngIf="isLoadingMoreReviews">Loading...</span>
                    <svg *ngIf="!isLoadingMoreReviews" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                    </svg>
                    <div *ngIf="isLoadingMoreReviews" class="loading-spinner"></div>
                </button>
                <p class="reviews-counter">Showing {{ reviews.length }} of {{ totalReviews }} reviews</p>
            </div>

            <!-- Show when all reviews are loaded -->
            <div class="all-reviews-loaded" *ngIf="!hasMoreReviews && reviews.length > 0">
                <p>All reviews loaded</p>
            </div>

        </div>





    </div>





</div>